<!DOCTYPE html>
<html>
<head>
  <title>맛집 추천</title>
  <style>
    /* HTML과 body를 전체 크기로 설정 */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
    /* 지도 컨테이너를 전체 화면으로 */
    #map {
      height: 100%;
      width: 100%;
      position: absolute;
      top: 0;
      left: 0;
    }
    /* 검색창과 버튼을 지도 위에 겹치도록 설정 */
    .controls {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1;
      background: white;
      padding: 5px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    #searchInput {
      margin: 0 5px;
      padding: 5px;
    }
  </style>
</head>
<body>
    <div class="controls">
      <h1>맛집 추천</h1>
      <input type="text" id="searchInput" placeholder="식당 이름 검색">
      <button onclick="searchRestaurant()">검색</button>
    </div>
    <div id="map"></div>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB2cf3YWzGrwU9WXlKGVVLFi73cnZ99Cd0&callback=initMap" async defer></script>
  <script>
    let map;
    let restaurants = [
      { name: "고기집", lat: 37.5172, lng: 127.0473, revisitIntent: 90, revisitRate: 80 },
      { name: "파스타 맛집", lat: 37.5200, lng: 127.0450, revisitIntent: 85, revisitRate: 70 },
      { name: "카페 드림", lat: 37.5150, lng: 127.0500, revisitIntent: 95, revisitRate: 85 },
      { name: "분식 천국", lat: 37.5180, lng: 127.0400, revisitIntent: 80, revisitRate: 65 },
      { name: "초밥 왕", lat: 37.5140, lng: 127.0480, revisitIntent: 88, revisitRate: 75 },
    ];

    function initMap() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const userLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            setupMap(userLocation);
          },
          (error) => {
            console.error("위치 정보를 가져오지 못했습니다:", error);
            const defaultLocation = { lat: 37.5172, lng: 127.0473 };
            setupMap(defaultLocation);
            alert("위치 정보를 가져오지 못해 강남역을 기본 위치로 설정했습니다.");
          }
        );
      } else {
        const defaultLocation = { lat: 37.5172, lng: 127.0473 };
        setupMap(defaultLocation);
        alert("이 브라우저는 위치 정보를 지원하지 않습니다. 강남역을 기본 위치로 설정했습니다.");
      }
    }

    function setupMap(center) {
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 14,
        center: center,
      });

      new google.maps.Marker({
        position: center,
        map: map,
        title: "내 위치",
        icon: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
      });

      restaurants.forEach(restaurant => {
        const markerColor = restaurant.revisitRate >= 80 ? "http://maps.google.com/mapfiles/ms/icons/green-dot.png" :
                          restaurant.revisitRate <= 60 ? "http://maps.google.com/mapfiles/ms/icons/red-dot.png" :
                          "http://maps.google.com/mapfiles/ms/icons/yellow-dot.png";
        const marker = new google.maps.Marker({
          position: { lat: restaurant.lat, lng: restaurant.lng },
          map: map,
          title: restaurant.name,
          icon: markerColor,
        });
        const infoWindow = new google.maps.InfoWindow({
          content: `<b>${restaurant.name}</b><br>재방문의사: ${restaurant.revisitIntent}%<br>재방문율: ${restaurant.revisitRate}%`,
        });
        marker.addListener("click", () => infoWindow.open(map, marker));
      });
    }

    function searchRestaurant() {
      const input = document.getElementById("searchInput").value.toLowerCase();
      const found = restaurants.find(r => r.name.toLowerCase().includes(input));
      if (found) {
        map.setCenter({ lat: found.lat, lng: found.lng });
        map.setZoom(16);
        alert(`${found.name} 찾았어요!`);
      } else {
        alert("검색 결과가 없어요.");
      }
    }
  </script>
</body>
</html>